define(["modules/default/defaultview","src/util/debug","lodash","src/util/util","src/util/api","src/util/typerenderer","slickgrid"],function(Default,Debug,_,Util,API,Renderer,Slick){function View(){}function waitingFormatter(){return"..."}function binFormatter(){return'<div style="width:100%; height: 100%; display: table-cell"><a class="recycle-bin"><i class="fa fa-trash"></i></a></div>'}function requiredFieldValidator(a){return null!=a&&void 0!=a&&a.length?{valid:!0,msg:null}:{valid:!1,msg:"This is a required field"}}function typeRenderer(a,b,c,d){c.__group||(this.module.data.traceSync([b]),a&&Renderer.render(a,c,d.jpath))}function getColumnFilterFunction(a){var b;if(b=a.match(/^"(.*)"$/))return function(a){return b=b.toLowerCase(),a=a.toString().toLowerCase(),a.match(b[1])};if(b=a.match(/^\/(.*)\/(i?)/))return function(a){return a.toString().match(new RegExp(b[1],b[2]||void 0))};if(b=a.match(/^([<>=]{1,2})([0-9.]+)$/)){if("<"===b[1])return function(a){return a<b[2]};if("<="===b[1]||"=<"===b[1])return function(a){return a<=b[2]};if(">"===b[1])return function(a){return a>b[2]};if(">="===b[1]||"=>"===b[1])return function(a){return a>=b[2]};if("=="===b[1]||"="===b[1])return function(a){return a==b[2]}}return b=a.match(/^([0-9.]+)\.\.([0-9.]*)$/),b?function(a){return a>=b[1]&&a<=b[2]}:function(b){return b.toString().toLowerCase().match(a.toLowerCase())}}var cssPromises=[];cssPromises.push(Util.loadCss("components/slickgrid/slick.grid.css"));var cssLoaded=Promise.all(cssPromises),columnFilters={},columnFilterFunctions={},uniqueID=0,formatters={typerenderer:waitingFormatter,"slick.text":Slick.Formatters.Text,"slick.percent":Slick.Formatters.PercentComplete,"slick.percentbar":Slick.Formatters.PercentCompleteBar,"slick.yesno":Slick.Formatters.YesNoSelect},typeEditors={boolean:Slick.CustomEditors.Checkbox,mf:Slick.CustomEditors.TextValue,color:Slick.CustomEditors.ColorValue,string:Slick.CustomEditors.TextValue,number:Slick.CustomEditors.TextValue,date:Slick.CustomEditors.Date,DataString:Slick.CustomEditors.DataStringEditor,DataNumber:Slick.CustomEditors.DataNumberEditor,DataBoolean:Slick.CustomEditors.DataBooleanEditor,longtext:Slick.CustomEditors.LongText};$.extend(!0,View.prototype,Default,{init:function(){var that=this;this.$container||(this._id=Util.getNextUniqueId(),this.$rowHelp=$("<div>").attr("class","rowHelp"),this.$container=$("<div>").attr("id",this._id).addClass("main-container"),this.module.getDomContent().html(this.$rowHelp),this.module.getDomContent().append(this.$container)),this.actionOutButtons=this.module.getConfiguration("actionOutButtons"),this.actionOutButtons=this.actionOutButtons||[],this.actionOutButtons=_.filter(this.actionOutButtons,function(a){return a.actionName&&a.buttonTitle}),this.$container.on("mouseleave",function(){that.module.controller.lastHoveredItemId=null}),this.slick={},this.colConfig=(this.module.getConfiguration("cols")||[]).filter(function(a){return a.name}),this.idPropertyName="_sgid",this.hiddenColumns=[];var filter=this.module.getConfiguration("filterRow");filter&&eval("that.filter = function(view, row, rowId) { try { \n "+filter+"\n } catch(_) { console.log(_); } }"),this.resolveReady()},preventRowHelp:function(){this._preventRowHelp=!0},deleteRowSelection:function(){for(var a=this.grid.getSelectedRows(),b=new Array(a.length),c=0;c<a.length;c++){var d=this._getItemInfoFromRow(a[c]);b[c]=d.idx}b=b.sort();var e=0,f=[];for(c=0;c<a.length;c++){var g=this.module.data.splice(b[c]-e++,1);g.length&&f.push(g[0])}this.lastSelectedRows=[],this.module.controller.onRowsDelete(f),this.module.data.triggerChange()},getAllSlickColumns:function(){function a(a){var d,e=c.module.data.get(0).getChildSync(a);return d=e instanceof DataString?Slick.CustomEditors.DataStringEditor:e instanceof DataNumber?Slick.CustomEditors.DataNumberEditor:e instanceof DataBoolean?Slick.CustomEditors.DataBooleanEditor:typeEditors[b(a)]}function b(a){var b,d=c.module.data.get(0).getChildSync(a);return d instanceof DataObject&&(b=d.type),b}var c=this,d=$.proxy(typeRenderer,this),e=this.colConfig.filter(function(a){return a.name}).map(function(e){var f,g;return"auto"===e.editor&&c.module.data?c.module.data.length?(f=a(e.jpath),g=b(e.jpath)):(f=Slick.CustomEditors.DataString,Debug.warn("Slick grid: using editor based on type when the input variable is empty. Cannot determine type")):(f=typeEditors[e.editor],g=b(e.jpath)),{id:e.name,name:e.name,field:e.name,width:+e.width||void 0,minWidth:+e.minWidth||void 0,maxWidth:+e.maxWidth||void 0,resizable:!0,selectable:!0,focusable:!0,sortable:!0,defaultSortAsc:!0,editor:f,compositeEditor:f===Slick.CustomEditors.LongText?Slick.CustomEditors.SimpleLongText:void 0,formatter:formatters[e.formatter],asyncPostRender:"typerenderer"===e.formatter?d:void 0,jpath:e.jpath,simpleJpath:1===e.jpath.length,dataType:g,colDef:e}});if(e=_.filter(e,function(a){return a.name}),_.isEmpty(e)){for(var f=[],g=0;g<c.module.data.length;g++)f=_(f).push(_.keys(c.module.data[g])).flatten().uniq().value();e=_(f).filter(function(a){return"_"!==a[0]}).map(function(c){return{id:c,name:c,field:c,resisable:!0,selectable:!0,focusable:!0,sortable:!1,editor:a([c]),dataType:b([c]),jpath:[c],formatter:formatters.typerenderer,asyncPostRender:d}}).value()}if(this.module.getConfigurationCheckbox("autoColumns","remove")&&e.unshift({id:"rowDeletion",width:30,field:"rowDeletion",selectable:!1,resizable:!1,focusable:!1,sortable:!1,formatter:binFormatter}),this.module.getConfigurationCheckbox("autoColumns","select")){var h=new Slick.CheckboxSelectColumn({cssClass:"slick-cell-checkboxsel"});this.slick.plugins.push(h),e.unshift(h.getColumnDefinition())}return e},getSlickColumns:function(){var a=this,b=this.getAllSlickColumns();return b.filter(function(b){return-1===a.hiddenColumns.indexOf(b.name)})},getSlickOptions:function(){var a=this;return{editable:a.module.getConfigurationCheckbox("slickCheck","editable"),enableAddRow:a.module.getConfigurationCheckbox("slickCheck","enableAddRow"),enableCellNavigation:a.module.getConfigurationCheckbox("slickCheck","editable"),autoEdit:a.module.getConfigurationCheckbox("slickCheck","autoEdit"),enableTextSelectionOnCells:!0,enableColumnReorder:!0,forceFitColumns:a.module.getConfigurationCheckbox("slickCheck","forceFitColumns"),multiColumnSort:!0,asyncEditorLoading:!0,asyncEditorLoadDelay:30,enableAsyncPostRender:!0,asyncPostRenderDelay:0,defaultColumnWidth:a.module.getConfiguration("slick.defaultColumnWidth")||80,dataItemColumnValueExtractor:function(a){return a},explicitInitialization:!0,rowHeight:a.module.getConfiguration("slick.rowHeight"),showHeaderRow:a.module.getConfigurationCheckbox("slickCheck","filterColumns"),headerRowHeight:30}},_openDetails:function(){var a=this;if(!this.grid.getEditorLock().isActive()||this.grid.getEditorLock().commitCurrentEdit()){var b=this.slick.columns.filter(function(a){return a.editor});if(0!==b.length){var c=$("<div class='item-details-form'></div>");c=$.tmpl("<div class='item-details-form'>\n    {{each columns}}\n    <div class='item-details-label'>\n        ${name}\n    </div>\n    <div class='item-details-editor-container' data-editorid='${id}'></div>\n    {{/each}}\n\n    <hr/>\n    <div class='item-details-form-buttons'>\n        <button data-action='save'>Save</button>\n        <button data-action='cancel'>Cancel</button>\n    </div>\n</div>",{context:this.grid.getDataItem(this.grid.getActiveCell().row),columns:b}).appendTo("body"),c.keydown(function(b){b.which==$.ui.keyCode.ENTER?(a.grid.getEditController().commitCurrentEdit(),b.stopPropagation(),b.preventDefault()):b.which==$.ui.keyCode.ESCAPE&&(a.grid.getEditController().cancelCurrentEdit(),b.stopPropagation(),b.preventDefault())}),c.find("[data-action=save]").click(function(){a.grid.getEditController().commitCurrentEdit()}),c.find("[data-action=cancel]").click(function(){a.grid.getEditController().cancelCurrentEdit()});var d=$.map(b,function(a){return c.find("[data-editorid="+a.id+"]")}),e=new Slick.CompositeEditor(b,d,{destroy:function(){c.remove()}});this.grid.editActiveCell(e)||c.remove()}}},inDom:function(){},update:{list:function(a){function b(a){for(var b in columnFilters)if(void 0!==b&&""!==columnFilters[b]){var d=c.slick.data.getIdxById(a[c.idPropertyName]),e=c.grid.getColumns()[c.grid.getColumnIndex(b)],f=_.clone(DataObject.resurrect(e.jpath));if(f.unshift(d),!c.module.data.getChildSync(f)||!columnFilterFunctions[b](c.module.data.getChildSync(f).get()))return!1}return!0}var c=this;this.module.data=a,this._highlights=_.pluck(this.module.data,"_highlight"),this.dataObjectsDone=!1,this.slick.plugins=[],this.slick.options=this.getSlickOptions(),this.generateUniqIds(),this.addRowAllowed=this.module.getConfigurationCheckbox("slickCheck","enableAddRow"),cssLoaded.then(function a(){if(c.$container.html(""),c.slick.columns=c.getSlickColumns(),c.$rowToolbar=$("<div>").attr("class","rowToolbar"),c.module.getConfigurationCheckbox("toolbar","add")&&(c.$addButton=$('<input type="button" value="New"/>'),c.$addButton.on("click",function(){var a=c.grid.getColumns(),b=_.findIndex(a,function(a){return a.editor});b>-1&&(c.preventRowHelp(),c.grid.gotoCell(c.slick.data.getLength(),b,!0)),c._openDetails()}),c.$rowToolbar.append(c.$addButton)),c.module.getConfigurationCheckbox("toolbar","update")&&(c.$updateButton=$('<input type="button" value="Update"/>'),c.$updateButton.on("click",function(){c._openDetails()}),c.$rowToolbar.append(c.$updateButton)),c.module.getConfigurationCheckbox("toolbar","remove")&&(c.$deleteButton=$('<input type="button" value="Delete"/>'),c.$deleteButton.on("click",function(){c.deleteRowSelection()}),c.$rowToolbar.append(c.$deleteButton)),c.module.getConfigurationCheckbox("toolbar","showHide")){var d=c.getAllSlickColumns().filter(function(a){return"rowDeletion"!==a.id&&"_checkbox_selector"!==a.id});c.$showHideSelection=$.tmpl('<input type="button" value="Show/Hide Column"/>\n    <div class="mutliSelect" style="display:none">\n        <ul>\n            {{each columns}}\n            \n            <li><input type="checkbox" value="${name}" checked/>${name}</li>\n            {{/each}}\n        </ul>\n    </div>',{columns:d}),c.columnSelectionShown&&c.$showHideSelection.filter("div").show(),c.$showHideSelection.on("click",function(){c.$showHideSelection.filter("div").toggle(),c.columnSelectionShown=c.$showHideSelection.filter("div").is(":visible"),c.onResize()});for(var e=0;e<c.hiddenColumns.length;e++)c.$showHideSelection.find('input[value="'+c.hiddenColumns[e]+'"]').removeAttr("checked");c.$showHideSelection.find('input[type="checkbox"]').on("change",function(){if(this.checked){var b=c.hiddenColumns.indexOf(this.value);b>-1&&c.hiddenColumns.splice(b,1)}else c.hiddenColumns.push(this.value);return c.$container.html(""),a()}),c.$rowToolbar.append(c.$showHideSelection)}c.$actionButtons=new Array(c.actionOutButtons.length);for(var e=0;e<c.actionOutButtons.length;e++)!function(a){c.$actionButtons[a]=$('<input type="button" value="'+c.actionOutButtons[a].buttonTitle+'"/>'),c.$actionButtons[a].on("click",function(){c.module.controller.sendActionButton(c.actionOutButtons[a].actionName,c._getSelectedItems())})}(e);c.$rowToolbar.append(c.$actionButtons),c.$container.append(c.$rowToolbar),c.module.getConfiguration("toolbar")&&0===c.module.getConfiguration("toolbar").length&&c.$actionButtons&&0===c.$actionButtons.length&&c.$rowToolbar&&c.$rowToolbar.remove(),c.$slickgrid=$("<div>").addClass("flex-1"),c.$container.append(c.$slickgrid),c.slick.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider,c.slick.plugins.push(c.slick.groupItemMetadataProvider),c.slick.data=new Slick.Data.DataView({groupItemMetadataProvider:c.slick.groupItemMetadataProvider}),c.slick.data.setModule(c.module),c.grid=new Slick.Grid(c.$slickgrid,c.slick.data,c.slick.columns,c.slick.options);for(var e=0;e<c.slick.plugins.length;e++)c.grid.registerPlugin(c.slick.plugins[e]);c.grid.setSelectionModel("row"===c.module.getConfiguration("slick.selectionModel")?new Slick.RowSelectionModel:new Slick.CellSelectionModel),c._activateHighlights(),c.grid.module=c.module,c.module.getConfigurationCheckbox("slickCheck","oneUncollapsed")&&c.slick.groupItemMetadataProvider.onGroupExpanded.subscribe(function(a,b){this.getData().collapseAllGroups(b.item.level),this.getData().expandGroup(b.item.groupingKey)}),c.slick.data.onRowCountChanged.subscribe(function(){c.grid.updateRowCount(),c.grid.render()}),c.slick.data.onRowsChanged.subscribe(function(a,b){if(!c.module.getConfigurationCheckbox("justInTimeFilter","yes")&&c.filter)for(var d=0;d<b.rows.length;d++){var e=b.rows[d],f=c._getItemInfoFromRow(e);c.filter(c,f.item,f.id)}c.grid.invalidateRows(b.rows),c.grid.render()}),c.grid.onAddNewRow.subscribe(function(){c.module.controller.onRowNew(c.module.data.length-1,c.module.data[c.module.data.length-1]),c.module.model.dataTriggerChange(c.module.data),c._resetDeleteRowListeners()}),c.grid.onViewportChanged.subscribe(function(){function a(){if(c.lastViewport=c.grid.getViewport(),c.module.getConfigurationCheckbox("slickCheck","rowNumbering")&&!c._preventRowHelp){var a=c.grid.getDataLength();c.$rowHelp.html(Math.min(a,c.lastViewport.bottom-(c.addRowAllowed?2:1)).toString()+"/"+a),c.$rowHelp.fadeIn(),clearTimeout(c.lastRowHelp),c.lastRowHelp=setTimeout(function(){c.$rowHelp.fadeOut()},1e3)}c._preventRowHelp=!1,c._resetDeleteRowListeners(),c._jpathColor(),c._justInTimeFilter()}setTimeout(function(){var b=c.grid.getViewport();b!==c.lastViewport&&a()},250),a()}),c.grid.onMouseEnter.subscribe(function(a){c._hl&&API.highlightId(c._hl,0),c.count=void 0===c.count?0:c.count,c.count++,c.hovering=!0;var b=c._getItemInfoFromEvent(a);if(b){var d=b.item._highlight;c._hl=d,d&&(API.highlightId(d,1),lastHighlight=d),c.module.controller.onHover(b.idx,b.item)}}),c.grid.onMouseLeave.subscribe(function(a){c._e=a,c.count--,c.hovering=!1;var b=c._getItemInfoFromEvent(a);if(b){var d=b.item._highlight;d?API.highlightId(d,0):lastHighlight&&API.highlightId(lastHighlight,0)}}),c.grid.onColumnsResized.subscribe(function(){var a=c.grid.getColumns().filter(function(a){return"rowDeletion"!==a.id&&"_checkbox_selector"!==a.id});if(c.colConfig.length===a.length)for(var b=0;b<a.length;b++){var d=c.colConfig.filter(function(c){return c===a[b].colDef});d.length&&(d[0].width=a[b].width)}c.grid.invalidate()}),c.grid.onCellChange.subscribe(function(a,b){var d=c._getItemInfoFromRow(b.row);c.filter&&c.filter(c,d.item,d.id),d&&c.module.controller.onRowChange(d.idx,d.item),c._resetDeleteRowListeners()}),c.grid.onClick.subscribe(function(a,b){var d=c.grid.getColumns(),e=c._getItemInfoFromRow(b.row);e&&d[b.cell]&&"rowDeletion"!==d[b.cell].id&&c.module.controller.onClick(e.idx,e.item)}),c.grid.onActiveCellChanged.subscribe(function(a,b){c.lastActiveCell=b.cell,c.lastActiveRow=b.row;var d=c.grid.getColumns(),e=c._getItemInfoFromRow(b.row);e&&d[b.cell]&&"rowDeletion"!==d[b.cell].id&&c.module.controller.onActive(e.idx,e.item)}),c.grid.onColumnsReordered.subscribe(function(){var a=c.grid.getColumns(),b=c.module.definition.configuration.groups.cols[0],d=_.pluck(b,"name"),e=_.pluck(a,"id");if(d.concat().sort().join()!==e.concat().sort().join())return void Debug.warn("Something might be wrong, number of columns in grid and in configuration do not match");c.module.definition.configuration.groups.cols[0]=[];for(var f=0;f<a.length;f++){var g=d.indexOf(e[f]);g>-1&&c.module.definition.configuration.groups.cols[0].push(b[g])}}),c.grid.onSelectedRowsChanged.subscribe(function(a,b){c.lastSelectedRows=b.rows;var d=c._getItems(b.rows);c.module.controller.onRowsSelected(d)}),c.grid.onSort.subscribe(function(a,b){c._makeDataObjects();var d=c.slick.data.getItems(),e=0;for(e=0;e<d.length;e++)d[e].__elementPosition=e;var f;for(f=b.sortCols?b.sortCols:[{sortCol:b.sortCol,sortAsc:b.sortAsc}],e=f.length-1;e>=0;e--)!function(a){var b=function(b,c){var d=b.getChildSync(f[a].sortCol.jpath),e=c.getChildSync(f[a].sortCol.jpath);return void 0===d?f[a].sortAsc?1:-1:void 0===e?f[a].sortAsc?-1:1:(d=d.get(),e=e.get(),e>d?-1:d>e?1:b.__elementPosition-c.__elementPosition)};c.slick.data.sort(b,f[a].sortAsc)}(e);for(e=0;e<d.length;e++)delete d[e].__elementPosition;c._jpathColor(),c._justInTimeFilter()}),$(c.grid.getHeaderRow()).delegate(":input","change keyup",function(){var a=$(this).data("columnId");null!=a&&(columnFilters[a]=$.trim($(this).val()),columnFilterFunctions[a]=getColumnFilterFunction(columnFilters[a]),c.slick.data.refresh())}),c.grid.onHeaderRowCellRendered.subscribe(function(a,b){$(b.node).empty(),$("<input type='text'>").css("width","100%").data("columnId",b.column.id).val(columnFilters[b.column.id]).appendTo(b.node)}),c.grid.init(),c.slick.data.beginUpdate();var f=_.chain(c.module.getConfiguration("groupings")).filter(function(a){return a&&a.groupName&&a.getter?!0:!1}).map(function(a){var b={};return a.getter&&a.getter.length>1?(b.getter=function(b){return b.getChildSync(a.getter)},c._makeDataObjects()):b.getter=a.getter[0],b.formatter=function(b){return a.groupName+": "+b.value+"  <span style='color:green'>("+b.count+" items)</span>"},b.aggregateCollapsed=!1,b.lazyTotalsCalculation=!0,b}).value();f.length&&(c.slick.data.setGrouping(f),c.module.getConfigurationCheckbox("slickCheck","collapseGroup")&&c.slick.data.collapseAllGroups(0)),c.module.getConfigurationCheckbox("slickCheck","filterColumns")&&c.slick.data.setFilter(b),c.slick.data.setItems(c.module.data,c.idPropertyName),c.slick.data.endUpdate(),c.lastViewport&&!c.module.getConfigurationCheckbox("slickCheck","backToTop")&&c.grid.scrollRowToTop(c.lastViewport.top),Array.isArray(c.lastSelectedRows)?c.grid.setSelectedRows(c.lastSelectedRows):_.isUndefined(c.lastActiveRow)||c.module.getConfigurationCheckbox("slickCheck","forgetLastActive")||c.grid.setActiveCell(c.lastActiveRow,c.lastActiveCell),c.grid.render(),c._resetDeleteRowListeners(),c._setBaseCellCssStyle(),c.lastViewport=c.grid.getViewport(),c._jpathColor(),c._justInTimeFilter()})}},blank:{list:function(){this.$container.html("")}},_setBaseCellCssStyle:function(){var a=this.grid.getColumns();this.baseCellCssStyle={};for(var b=0;b<a.length;b++)this.baseCellCssStyle[a[b].id]="highlighted-cell"},_resetDeleteRowListeners:function(){var a=this,b=a.$rb=$("#"+a._id).find("a.recycle-bin");b.off("click"),b.on("click",function(b){var c=a.grid.getColumns(),d=a.grid.getCellFromEvent(b);if(a.lastViewport=a.grid.getViewport(),c[d.cell]&&"rowDeletion"===c[d.cell].id){var e=a._getItemInfoFromRow(d.row),f=a.module.data.splice(e.idx,1);f.length&&a.module.controller.onRowsDelete(f),a.module.data.triggerChange()}})},_getItemInfoFromEvent:function(a){var b=this,c=this.grid.getCellFromEvent(a);if(!c)return null;var d=b.slick.data.mapRowsToIds([c.row])[0];return d?{id:d,idx:b.slick.data.getIdxById(d),item:b.slick.data.getItemById(d)}:null},_getItemInfoFromRow:function(a){var b=this;if(_.isUndefined(a))return null;var c=b.slick.data.mapRowsToIds([a])[0];return c?{id:c,idx:b.slick.data.getIdxById(c),item:b.slick.data.getItemById(c)}:null},_jpathColor:function(){var a=this;if(a.lastViewport){var b=a.module.getConfiguration("colorjPath"),c=a.grid.getColumns();if(b&&b.length>0){a._makeDataObjects();for(var d=a.lastViewport.top;d<=a.lastViewport.bottom;d++){var e=a.grid.getDataItem(d);if(e&&e.__group!==!0){var f=e.getChildSync(b);if(f)for(var g=0;g<c.length;g++){var h=a.grid.getCellNode(d,g);$(h).css("background-color",f.get())}}}}}},_justInTimeFilter:function(){var a=this;if(a.filter&&a.lastViewport&&a.module.getConfigurationCheckbox("justInTimeFilter","yes"))for(var b=a.lastViewport.top;b<=a.lastViewport.bottom;b++){var c=a.grid.getDataItem(b);a.filter(a,c,c[a.idPropertyName])}},_selectHighlight:function(){if(!this.hovering){var a=this,b=_.findIndex(this._highlights,function(b){return b===a._highlighted[0]||b.indexOf&&b.indexOf(a._highlighted[0])>-1});if(this.lastViewport=this.grid.getViewport(),b>-1&&this.module.getConfigurationCheckbox("slickCheck","highlightScroll")){var c=a.slick.data.getItemByIdx(b),d=a.slick.data.mapIdsToRows([c[a.idPropertyName]])[0];if(!d)return;(d<this.lastViewport.top||d>=this.lastViewport.bottom)&&this.grid.scrollRowToTop(d)}}},_drawHighlight:function(){var a=this;this.grid.removeCellCssStyles("highlight");var b={};this._selectHighlight(),this.lastViewport=this.grid.getViewport();for(var c=this.lastViewport.top;c<=this.lastViewport.bottom;c++){var d=this.grid.getDataItem(c);d&&_.any(a._highlighted,function(a){var b=d._highlight;return Array.isArray(b)||(b=[b]),b.indexOf(a)>-1})&&(b[c]=a.baseCellCssStyle)}this.grid.setCellCssStyles("highlight",b)},_activateHighlights:function(){var a=this,b=_(this.module.data).pluck("_highlight").flatten().filter(function(a){return!_.isUndefined(a)}).value();a._highlighted=[],API.killHighlight(this.module.getId());for(var c=0;c<b.length;c++)!function(c){API.listenHighlight({_highlight:b[c]},function(b,c){Array.isArray(c)||(c=[c]),a._highlighted=b?_(a._highlighted).push(c).flatten().uniq().value():_.filter(a._highlighted,function(a){return-1===c.indexOf(a)}),a._drawHighlight()},!1,a.module.getId())}(c)},_makeDataObjects:function(){if(!this.dataObjectsDone){for(var a=0;a<this.module.data.length;a++)this.module.data[a]=DataObject.check(this.module.data[a]);this.dataObjectsDone=!0}},_getItems:function(a){for(var b=[],c=0;c<a.length;c++){var d=this._getItemInfoFromRow(a[c]);d&&b.push(d.item)}return b},_getSelectedItems:function(){return this._getItems(this.grid.getSelectedRows())},onResize:function(){this.grid&&this.grid.resizeCanvas(),this.$rowHelp.css({bottom:0})},getNextIncrementalId:function(){return++uniqueID},generateUniqIds:function(){if(this.module.data)for(var a=0;a<this.module.data.length;a++)this.module.data[a][this.idPropertyName]||Object.defineProperty(this.module.data[a],this.idPropertyName,{value:"id_"+ ++uniqueID,writable:!1,configurable:!1,enumerable:!1})},exportToTabDelimited:function(){var a,b,c=this.grid.getColumns(),d="",e=[];for(a=0;a<c.length;a++)c[a].jpath&&e.push(c[a].name||"");for(d+=e.join("	")+"\r\n",a=0;a<this.module.data.length;a++){for(e=[],b=0;b<c.length;b++){var f=c[b].jpath;if(f){f=f.slice(0),f.unshift(a);var g=this.module.data.getChildSync(f,!1);g=g?g.get():"","string"==typeof g&&(g=g.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")),e.push(g)}}d+=e.join("	")+"\r\n"}return d},onActionReceive:{hoverRow:function(a){var b;if(b=_.isNumber(a)||a instanceof DataNumber?this.module.data[a]:a,b&&b[this.idPropertyName]){var c=this.slick.data.mapIdsToRows([b[this.idPropertyName]])[0],d=this.slick.data.getIdxById(b[this.idPropertyName]);this.module.controller.onHover(d,b),this.grid.scrollRowToTop(c)}},selectRow:function(a){var b;if(b=_.isNumber(a)||a instanceof DataNumber?this.module.data[a]:a,b&&b[this.idPropertyName]){var c=this.slick.data.mapIdsToRows([b[this.idPropertyName]])[0],d=this.slick.data.getIdxById(b[this.idPropertyName]);this.module.controller.onClick(d,b),_.isUndefined(c)||(this.grid.scrollRowToTop(c),this.grid.setActiveCell(c,0))}}}});var lastHighlight="";return View});