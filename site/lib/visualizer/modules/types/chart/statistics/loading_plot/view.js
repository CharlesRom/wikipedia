define(["modules/default/defaultview","src/util/util","lib/loadingplot/libs/jquery.mousewheel.min","lib/loadingplot/svg","lib/loadingplot/point","lib/loadingplot/springs"],function(a,b){function c(){}return b.loadCss("lib/loadingplot/svg.css"),c.prototype=$.extend(!0,{},a,{init:function(){this.dom=$('<div class="ci-display-loading-plot"></div>'),this.module.getDomContent().html(this.dom),this.resolveReady()},onResize:function(a,b){this._w=a-10,this._h=b-10,this._w&&this._h&&this._svg&&this._svg.setSize(this._w,this._h)},blank:{loading:function(){this.dom&&this.dom.empty()}},update:{preferences:function(a){if(this._lastConf=a,this._lastValue)for(var b in a)for(var c=0;c<this._lastValue.series.length;c++)if(this._lastValue.series[c].category==b)for(var d=0;d<this._lastValue.series[c].data.length;d++)this._instances[c][d].filter(a[b])},center:function(a){a&&this._svg.setCenter.apply(this._svg,a)},zoom:function(a){console.log(a),a&&this._svg.setZoom(a)},viewport:function(a){a&&this._svg.setViewBox.apply(this._svg,[!1].concat(a))},loading:function(a){var b=this;if(a&&a.value){this._highlights=[],this._svg&&(this._svg.remove(),this.dom.empty());var c=new LoadingPlot.SVG(null,null,null,null,this.module.getConfiguration("navigation")[0][0]||!1);c.onZoomChange(function(a){b.module.controller.onZoomChange(a),b.module.controller.onChangeViewport(c.getViewBox())}),c.onMove(function(a,d){b.module.controller.onMove(a,d),b.module.controller.onChangeViewport(c.getViewBox())}),this._svg=c,this._w&&this._h&&c.setSize(this._w,this._h);var d=a.value.minX||0,e=a.value.minY||0,f=(a.value.maxX||100)-d,g=(a.value.maxY||100)-e;c.setViewBoxWidth(d,e,f,g,!0),c.create(),c.bindTo(this.dom);var h=new LoadingPlot.SpringLabels(c);if(c.initZoom(),LoadingPlot.SVGElement.prototype.Springs=h,this._lastValue=a.value,this._instances=[],a.value&&a.value.series){for(var i=this.module.getConfiguration("layers"),j=0;j<i.length;j++){var k,l=i[j].groups.group[0],m=l.labels[0],n={};for(k=0;k<m.length;k++)n[m[k]]=!0;var o=l.el[0],p=l.type[0]||"ellipse";for(k=0;k<a.value.series.length;k++)if(a.value.series[k].category===o){for(var q,r=a.value.series[k].data,s=0,t=r.length;t>s;s++){"pie"===p?q=new LoadingPlot.Pie(c,r[s].x,r[s].y,r[s]):"ellipse"===p?q=new LoadingPlot.Ellipse(c,r[s].x,r[s].y,r[s]):"img"===p&&(q=new LoadingPlot.Image(c,r[s].x,r[s].y,r[s])),q.allowLabelDisplay(n.display_labels),l.labelsize[0]&&q.setLabelSize(l.labelsize[0]),q.forceField(n.forcefield),""!==l.labelzoomthreshold[0]&&q.setLabelDisplayThreshold(l.labelzoomthreshold[0]);var u=l.highlightmag[0]?l.highlightmag[0]:1,v=l.highlighteffect[0][0]?!0:!1;q.setHighlightMag(u),q.setHighlightEffect({mag:u,yStroke:v}),q.setLabelStroke(n.blackstroke),q.setLabelScale(n.scalelabel),q.hoverCallback=function(){b.module.controller.hover(this._data)},this._instances[k]=this._instances[k]||[],this._instances[k][s]=q,c.add(q)}break}}c.ready(),h.resolve(),this._lastConf&&this.update.preferences.call(this,this._lastConf)}}}}}),c});