define(["jquery","src/header/components/default","src/util/versioning","forms/button","src/util/util"],function(a,b,c,d,e){function f(){for(var b=["view","data"],f=0;f<b.length;f++)!function(f){var g=0==f?c.getView():c.getData(),i=0==f?c.getViewHandler():c.getDataHandler();h[b[f]].copyToLocal=new d("Copy to local",function(){i.serverCopy(g)},{color:"red"}),h[b[f]].snapshotLocal=new d("Snapshot",function(){i.localSnapshot(g)},{color:"blue"}),h[b[f]].autosaveLocal=new d("Autosave",function(a,b,c){i.localAutosave(b,function(){return g},function(){c.children().find("span").remove();var a=new Date;a=e.pad(a.getHours())+":"+e.pad(a.getMinutes()),c.children().append("<span> ("+a+")</span>")})},{checkbox:!0,color:"blue"}),h[b[f]].branchLocal=new d("Make branch",function(){require(["forms/formfactory","jquery-ui","forms/button"],function(b,c,d){var e=a("<div></div>").dialog({modal:!0,width:"80%",title:"Make brach"});e.parent().css("zIndex",1e4),b.newform(e,{sections:{cfg:{config:{multiple:!1,title:"Branch name"},groups:{general:{config:{type:"list"},fields:[{type:"Text",name:"name",multiple:!1,title:"Name"}]}}}}},function(a){var b=new d("Save",function(){a.dom.trigger("stopEditing");var b=a.getValue();i.localBranch(g,b.cfg[0].general[0].name[0]),a.getDom().dialog("close")});b.setColor("blue"),a.addButtonZone(b)})})},{color:"blue"}),h[b[f]].revertLocal=new d("Revert head",function(){i.localRevert(g)},{color:"blue"}),h[b[f]].localToServer=new d("Push to server",function(a,b,c){i.serverPush(g).done(function(){c.children().find("span").remove();var a=new Date;a=e.pad(a.getHours())+":"+e.pad(a.getMinutes()),c.children().append("<span> ("+a+")</span>")})},{color:"green"})}(f);return h}function g(){}var h={view:{},data:{}};return e.inherits(g,b,{getReady:function(){if(this.$_elToOpen)return this.$_elToOpen;this.$_elToOpen=a("<div />").attr("id","visualizer-dataviews"),this._ready=!0,f();var b=this.$_elToOpen;b.append("<h1>Data</h1>"),b.append(h.data.copyToLocal.render()),b.append(h.data.localToServer.render()),b.append(h.data.snapshotLocal.render()),b.append(h.data.autosaveLocal.render()),b.append(h.data.branchLocal.render()),b.append(h.data.revertLocal.render());var d=a('<div class="ci-dataview-path"><label>Data path : </label></div>');b.append(d);var e=a("<div />").appendTo(d);e.append(c.getDataHandler().getDom()),b.append("<br /><br />"),b.append("<h1>View</h1>"),b.append(h.view.copyToLocal.render()),b.append(h.view.localToServer.render()),b.append(h.view.snapshotLocal.render()),b.append(h.view.autosaveLocal.render()),b.append(h.view.branchLocal.render()),b.append(h.view.revertLocal.render());var d=a('<div class="ci-dataview-path"><label>View path : </label></div>');b.append(d);var e=a("<div />").appendTo(d);e.append(c.getViewHandler().getDom()),this._versionDiv=b,c.getViewHandler().updateButtons=this.updateButtons,c.getViewHandler().doUpdateButtons(),c.getDataHandler().updateButtons=this.updateButtons,c.getDataHandler().doUpdateButtons()},updateButtons:function(a,b,c){h[a].autosaveLocal&&("head"!==b||"local"!==c?h[a].autosaveLocal.disable():h[a].autosaveLocal.enable(),"local"==c?(h[a].copyToLocal.disable(),h[a].snapshotLocal.enable(),h[a].branchLocal.enable(),"head"==b?h[a].revertLocal.disable():h[a].revertLocal.enable()):(h[a].copyToLocal.enable(),h[a].snapshotLocal.disable(),h[a].branchLocal.disable(),h[a].revertLocal.disable()))},_onClick:function(){this.getReady();this.setStyleOpen(this._open),this._open?this.open():this.close()}}),g});