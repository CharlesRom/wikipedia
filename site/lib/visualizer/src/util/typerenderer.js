define(["require","jquery","src/util/api","src/util/util","src/util/datatraversing"],function(a,b,c,d,e){function f(c,e,f){a(["http://www.lactame.com/lib/actelion/3.0.0-alpha1/actelion-3.0.0-alpha1.js"],function(a){var g=d.getNextUniqueId(),h='<div id="'+g+'" style="width:100%; height:100%" />';f.build=function(){var f=b("#"+g),h=Math.max(150,f.height()),i=f.width(),j=d.getNextUniqueId(),k=b("<canvas>",{id:j}),l=k.get(0);l.height=h,l.width=i,f.html(k),a.StructureView.drawStructure(j,c,e)},f.resolve(h)})}function g(a,c,d,f,g){var i=e.getType(c),j=e.getHighlights(c);if(f=b.extend(f,e.getOptions(c)),!h[i])return a.resolve("");var k=c;c=e.get(c),!h[i].ready&&h[i].init&&(h[i].init(),h[i].ready=!0),h[i].toscreen(a,c,k,f,j,d,g)}d.loadCss("components/font-awesome/css/font-awesome.min.css");var h={};return h.string={},h.string.toscreen=function(a,b){for(b=String(b);;)if(b=b.replace("<","&lt;").replace(">","&gt;"),-1===b.indexOf("<")&&-1===b.indexOf(">"))break;a.resolve(b)},h.date={},h.date.toscreen=function(a,b){try{var c=new Date(b);a.resolve(c.toLocaleString())}catch(d){a.resolve("Invalid date")}},h.color={},h.color.toscreen=function(a,c){var d=b("<div><div/></div>");d.children().css({backgroundColor:c,width:"100%",height:"100%",padding:0,margin:0}),a.resolve(d.html())},h.html={},h.html.toscreen=function(a,b){a.resolve(String(b))},h.matrix={},h.matrix.toscreen=function(a,b){a.resolve(b)},h.number={},h.number.toscreen=function(a,b){a.reject(b.valueOf())},h.chemical={},h.chemical.toscreen=function(a,b){b.getChild(["iupac","0","value"]).then(a.resolve,a.reject)},h.picture={},h.picture.toscreen=function(a,b){a.reject('<img src="'+b+'" />')},h.svg={},h.svg.toscreen=function(a,c){var d=b(c),e=[0,0,parseInt(d.attr("width")),parseInt(d.attr("height"))];d[0].setAttribute("viewBox",e.join(" ")),d.removeAttr("id"),d.attr("width","100%"),d.attr("height","100%"),a.resolve(d)},h.gif=h.picture,h.jpeg=h.picture,h.jpg=h.picture,h.png=h.picture,h.doi={},h.doi.toscreen=function(a,b){return a.resolve(b.replace(/^(.*)$/,'<a target="_blank" href="http://dx.doi.org/$1"><img src="bin/logo/doi.png" /></a>'))},h.jme={},h.jme.toscreen=function(b,c,d,e,f,g){a(["lib/chemistry/jme-converter"],function(a){var d=a.toMolfile(c),i={type:"mol2d",value:d};h.mol2d.toscreen(b,d,i,e,f,g)})},h.smiles={},h.smiles.toscreen=function(b,c){a(["http://www.lactame.com/lib/actelion/3.0.0-alpha1/actelion-3.0.0-alpha1.js"],function(a){var d=a.Molecule.fromSmiles(String(c));f(d.getIDCode(),d.getIDCoordinates(),b)})},h.actelionID={},h.actelionID.toscreen=function(b,c,d){a(["http://www.lactame.com/lib/actelion/3.0.0-alpha1/actelion-3.0.0-alpha1.js"],function(a){if(d.coordinates)f(String(d.value),String(d.coordinates),b);else{var c=String(d.value),e=a.Molecule.fromIDCode(c,!0);f(c,e.getIDCoordinates(),b)}})},h.mol2d={},h.mol2d.toscreen=function(b,c){a(["http://www.lactame.com/lib/actelion/3.0.0-alpha1/actelion-3.0.0-alpha1.js"],function(a){var d=a.Molecule.fromMolfile(c);f(d.getIDCode(),d.getIDCoordinates(),b)})},h.molfile2D=h.mol2d,h.jcamp={},h.jcamp.hexToRgb=function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},h.id=0,h.cache=[],h.jcamp.toscreen=function(c,d,e){a(["lib/plot/plot","components/jcampconverter/src/jcampconverter"],function(a,d){var f=b("<div />").css({width:200,height:200}),g=new a(f.get(0),{closeRight:!1,closeTop:!1,zoomMode:""},{bottom:[{unitModification:!1,primaryGrid:!1,nbTicksPrimary:5,nbTicksSecondary:2,secondaryGrid:!1,axisDataSpacing:{min:0,max:0}}],left:[{ticklabelratio:1,primaryGrid:!0,nbTicksSecondary:4,secondaryGrid:!1,nbTicksPrimary:2,forcedMin:0,axisDataSpacing:{min:0,max:0}}]});g.resize(200,200),e=d.convert(e.value);var h=g.newSerie("serie",{lineToZero:!0});h.autoAxis(),h.setData(e.spectra[0].data[0]),c.resolve(g._dom),g.redraw(),g.drawSeries()})},h.mf={},h.mf.toscreen=function(a,b){return a.reject(b.replace(/\[([0-9]+)/g,"[<sup>$1</sup>").replace(/([a-zA-Z)])([0-9]+)/g,"$1<sub>$2</sub>").replace(/\(([0-9+-]+)\)/g,"<sup>$1</sup>"))},h.pdb={},h.pdb.toscreen=function(a,b){return a.resolve(b)},h.cif={},h.cif.toscreen=function(a,b){return a.resolve(b)},h.downloadLink={},h.downloadLink.toscreen=function(a,b){return a.resolve(b.replace(/^(.*)$/,'<a href="$1">â¤µ</a>'))},h["boolean"]={},h["boolean"].toscreen=function(a,b){a.resolve(b?'<span style="color: green;">&#10004;</span>':'<span style="color: red;">&#10008;</span>')},h.colorBar={},h.colorBar.toscreen=function(a,c){var d=b("<div>"),e="linear-gradient(to right",f=0,g=0,h=c.length;for(g=0;h>g;f+=c[g++][0]);var i,j,k=0;for(g=0;h>g;g++)i=k+c[g][0]/f*100,j=c[g][1],e+=", "+j+" "+k+"%, "+j+" "+i+"%",k=i;e+=")",d.css({height:"100%",width:"100%"}).css("background",e),a.resolve(d.get(0))},h.indicator={},h.indicator.init=function(){var a,c=b('<div class="ci-tooltip"></div>').css({display:"none",opacity:0}).appendTo("#ci-visualizer");b("#modules-grid").on("mouseenter","[data-tooltip]",function(d){a=setTimeout(function(){var a=b(d.target),e=a.offset();c.css({left:e.left,top:e.top,display:"block"}).text(a.attr("data-tooltip")),c.animate({opacity:1})},500)}),b("#modules-grid").on("mouseleave","[data-tooltip]",function(){clearTimeout(a),c.css({opacity:0,display:"none"})})},h.indicator.toscreen=function(c,d){a(["src/util/color"],function(a){Array.isArray(d)||c.reject("");var e='<table cellpadding="0" cellspacing="0" style="text-align: center; height:100%; width:100%"><tr>';isNaN(d[0])||(d=d.map(function(a){return{size:a}}));for(var f=d.length,g=a.getDistinctColors(d.length),h=0,i=0;f>i;i++)d[i].bgcolor||(d[i].bgcolor=g[i]),d[i].size||0===d[i].size||(d[i].size=10),h+=d[i].size;for(var i=0;f>i;i++)d[i].bgcolor||(d[i].bgcolor=g[i]),d[i].size||0===d[i].size||(d[i].size=10),h+=d[i].size;for(var i=0;f>i;i++){var j=d[i],k=b("<td>").css({width:100*j.size/h+"%",border:"none"});j.bgcolor&&k.css("background-color",j.bgcolor),j.color&&k.css("color",j.color),j.text&&k.append(j.text),j["class"]&&k.addClass(j["class"]),j.icon&&k.prepend('<i class="fa fa-'+j.icon+'"></i>'),j.css&&k.css(j.css),j.tooltip&&k.attr("data-tooltip",j.tooltip),e+=k.get(0).outerHTML}e+="</tr></table>",c.resolve(e)})},h.styledValue={},h.styledValue.toscreen=function(a,c,d,e,f,g,i){var j=b("<div>");j.css(c.css),h.toScreen(c.value,g,e,i).always(function(b){j.append(b),a.resolve(j.get(0))})},{toScreen:function(a,c,d,e){var f=b.Deferred();return a=DataObject.check(a,!0),e?(a.getChild(e).then(function(a){g(f,a,c,d,e)},function(){f.reject()}),f):(g(f,a,c,d,e),f)},addType:function(a,b){h[a]=b}}});